from utils.local_indicators import fetch_binance_klines

def load_price_at_entry(symbol: str, entry_time: int, tf: str = "1h") -> float:
    df = fetch_binance_klines(symbol, tf, 200)
    df = df[df["timestamp"] <= entry_time]
    if df.empty:
        return None
    return df.iloc[-1]["close"]

def build_mock_trade(symbol: str, entry_time: int, tf: str = "1h") -> dict:
    price = load_price_at_entry(symbol, entry_time, tf)
    if price is None:
        return {}
    return {
        "symbol": symbol,
        "entry_time": entry_time,
        "timestamp": entry_time,
        "deal_id": f"sim-{symbol}-{entry_time}",
        "drawdown_pct": 4.5,  # Optional
        "avg_entry_price": price,
    }
