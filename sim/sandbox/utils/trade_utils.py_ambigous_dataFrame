from .sandbox_kline_utils import load_klines_around_time



def load_price_at_entry(symbol: str, entry_time: int, tf: str = "1h") -> float:
    klines = load_klines_around_time(symbol, tf, entry_time)
    if not klines:
        return None
    valid = [k for k in klines if k["timestamp"] <= entry_time]
    if not valid:
        return None
    return valid[-1]["close"]


def build_mock_trade(symbol: str, entry_time: int, tf: str = "1h") -> dict:
    price = load_price_at_entry(symbol, entry_time, tf)
    if price is None:
        return {}
    return {
        "symbol": symbol,
        "entry_time": entry_time,
        "timestamp": entry_time,
        "deal_id": f"sim-{symbol}-{entry_time}",
        "drawdown_pct": 4.5,  # Optional
        "avg_entry_price": price,
    }
