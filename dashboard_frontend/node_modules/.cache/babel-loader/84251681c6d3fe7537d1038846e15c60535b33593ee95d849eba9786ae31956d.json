{"ast":null,"code":"// src/components/ui/TradeCardEnhanced.jsx\nimport React,{useState}from\"react\";import{RefreshCw}from\"lucide-react\";import{Button}from\"./Button\";import{Card}from\"./Card\";import{Sparkline}from\"./Sparkline\";import{PriceProgressBar}from\"./PriceProgressBar\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function TradeCard(_ref){let{trade}=_ref;const[liveTrade,setLiveTrade]=useState(trade);const[loading,setLoading]=useState(false);const{deal_id,symbol,avg_entry_price,current_price,tp1_shift,entry_score,current_score,confidence_score,recovery_odds,safu_score,step,open_pnl,sparkline_data=[],rejection_reason,be_price}=liveTrade;const entry=parseFloat(avg_entry_price)||1;const current=parseFloat(current_price)||entry;const breakEven=parseFloat(be_price)||entry;const tp1=breakEven*(1+(parseFloat(tp1_shift)||0)/100);const refreshPrice=async()=>{setLoading(true);try{const res=await fetch(`/refresh-price/${deal_id}`);const data=await res.json();if(data!==null&&data!==void 0&&data.current_price){setLiveTrade(prev=>{var _data$open_pnl,_data$pnl_pct;return{...prev,current_price:data.current_price,open_pnl:(_data$open_pnl=data.open_pnl)!==null&&_data$open_pnl!==void 0?_data$open_pnl:prev.open_pnl,pnl_pct:(_data$pnl_pct=data.pnl_pct)!==null&&_data$pnl_pct!==void 0?_data$pnl_pct:prev.pnl_pct};});}else{console.error(\"⚠️ Invalid refresh payload:\",data);}}catch(e){console.error(\"❌ Refresh error:\",e);}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(Card,{className:\"relative flex flex-col md:flex-row overflow-hidden rounded-2xl shadow-md bg-gray-900 dark:bg-gray-900\",children:[sparkline_data.length>1&&/*#__PURE__*/_jsx(\"div\",{className:\"md:w-1/3 h-36 p-2 relative overflow-hidden\",children:/*#__PURE__*/_jsx(Sparkline,{data:sparkline_data})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1 p-4 flex flex-col justify-between space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold tracking-wide\",children:symbol}),/*#__PURE__*/_jsx(Button,{size:\"sm\",onClick:refreshPrice,disabled:loading,children:loading?/*#__PURE__*/_jsx(RefreshCw,{className:\"w-4 h-4 animate-spin\"}):\"Refresh\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-muted-foreground\",children:[\"Entry: \",entry.toFixed(4),\"\\u2002\\u203A\\u2002TP1: \",tp1.toFixed(4)]}),rejection_reason&&/*#__PURE__*/_jsxs(\"div\",{className:\"italic text-yellow-400 text-sm\",children:[\"Reason: \",rejection_reason.toUpperCase()]}),/*#__PURE__*/_jsx(PriceProgressBar,{current:current,breakEven:breakEven,tp1:tp1}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 md:grid-cols-3 gap-4 text-xs text-muted-foreground\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:\"Score\"}),/*#__PURE__*/_jsxs(\"div\",{children:[entry_score===null||entry_score===void 0?void 0:entry_score.toFixed(2),\" \\u2192 \",current_score===null||current_score===void 0?void 0:current_score.toFixed(2)]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:\"Confidence\"}),/*#__PURE__*/_jsx(\"div\",{children:confidence_score===null||confidence_score===void 0?void 0:confidence_score.toFixed(2)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:\"Odds\"}),/*#__PURE__*/_jsx(\"div\",{children:recovery_odds===null||recovery_odds===void 0?void 0:recovery_odds.toFixed(2)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:\"SAFU\"}),/*#__PURE__*/_jsx(\"div\",{children:safu_score===null||safu_score===void 0?void 0:safu_score.toFixed(2)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:\"Step\"}),/*#__PURE__*/_jsx(\"div\",{children:step})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:\"PnL\"}),/*#__PURE__*/_jsxs(\"div\",{className:open_pnl<0?\"text-red-400\":\"text-green-400\",children:[(open_pnl!==null&&open_pnl!==void 0?open_pnl:0).toFixed(2),\" USDT\"]})]})]})]})]});}","map":{"version":3,"names":["React","useState","RefreshCw","Button","Card","Sparkline","PriceProgressBar","jsx","_jsx","jsxs","_jsxs","TradeCard","_ref","trade","liveTrade","setLiveTrade","loading","setLoading","deal_id","symbol","avg_entry_price","current_price","tp1_shift","entry_score","current_score","confidence_score","recovery_odds","safu_score","step","open_pnl","sparkline_data","rejection_reason","be_price","entry","parseFloat","current","breakEven","tp1","refreshPrice","res","fetch","data","json","prev","_data$open_pnl","_data$pnl_pct","pnl_pct","console","error","e","className","children","length","size","onClick","disabled","toFixed","toUpperCase"],"sources":["/home/signal/market7/dashboard_frontend/src/components/ui/TradeCardEnhanced.jsx"],"sourcesContent":["// src/components/ui/TradeCardEnhanced.jsx\n\nimport React, { useState } from \"react\";\nimport { RefreshCw } from \"lucide-react\";\nimport { Button } from \"./Button\";\nimport { Card } from \"./Card\";\nimport { Sparkline } from \"./Sparkline\";\nimport { PriceProgressBar } from \"./PriceProgressBar\";\n\nexport default function TradeCard({ trade }) {\n  const [liveTrade, setLiveTrade] = useState(trade);\n  const [loading, setLoading] = useState(false);\n\n  const {\n    deal_id,\n    symbol,\n    avg_entry_price,\n    current_price,\n    tp1_shift,\n    entry_score,\n    current_score,\n    confidence_score,\n    recovery_odds,\n    safu_score,\n    step,\n    open_pnl,\n    sparkline_data = [],\n    rejection_reason,\n    be_price,\n  } = liveTrade;\n\n  const entry = parseFloat(avg_entry_price) || 1;\n  const current = parseFloat(current_price) || entry;\n  const breakEven = parseFloat(be_price) || entry;\n  const tp1 = breakEven * (1 + (parseFloat(tp1_shift) || 0) / 100);\n\n  const refreshPrice = async () => {\n    setLoading(true);\n    try {\n      const res = await fetch(`/refresh-price/${deal_id}`);\n      const data = await res.json();\n\n      if (data?.current_price) {\n        setLiveTrade(prev => ({\n          ...prev,\n          current_price: data.current_price,\n          open_pnl: data.open_pnl ?? prev.open_pnl,\n          pnl_pct: data.pnl_pct ?? prev.pnl_pct,\n        }));\n      } else {\n        console.error(\"⚠️ Invalid refresh payload:\", data);\n      }\n    } catch (e) {\n      console.error(\"❌ Refresh error:\", e);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Card className=\"relative flex flex-col md:flex-row overflow-hidden rounded-2xl shadow-md bg-gray-900 dark:bg-gray-900\">\n      {/* ── LEFT: Sparkline ───────────────────────────── */}\n      {sparkline_data.length > 1 && (\n        <div className=\"md:w-1/3 h-36 p-2 relative overflow-hidden\">\n          <Sparkline data={sparkline_data} />\n        </div>\n      )}\n\n      {/* ── RIGHT: Content ───────────────────────────── */}\n      <div className=\"flex-1 p-4 flex flex-col justify-between space-y-4\">\n        {/* Header */}\n        <div className=\"flex justify-between items-center\">\n          <h2 className=\"text-xl font-bold tracking-wide\">{symbol}</h2>\n          <Button size=\"sm\" onClick={refreshPrice} disabled={loading}>\n            {loading \n              ? <RefreshCw className=\"w-4 h-4 animate-spin\" />\n              : \"Refresh\"}\n          </Button>\n        </div>\n\n        {/* Entry/TP1 & Reason */}\n        <div className=\"text-sm text-muted-foreground\">\n          Entry: {entry.toFixed(4)} › TP1: {tp1.toFixed(4)}\n        </div>\n        {rejection_reason && (\n          <div className=\"italic text-yellow-400 text-sm\">\n            Reason: {rejection_reason.toUpperCase()}\n          </div>\n        )}\n\n        {/* PnL Progress Bar */}\n        <PriceProgressBar\n          current={current}\n          breakEven={breakEven}\n          tp1={tp1}\n        />\n\n        {/* Stats Grid */}\n        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-4 text-xs text-muted-foreground\">\n          <div>\n            <div className=\"font-medium\">Score</div>\n            <div>\n              {entry_score?.toFixed(2)} → {current_score?.toFixed(2)}\n            </div>\n          </div>\n          <div>\n            <div className=\"font-medium\">Confidence</div>\n            <div>{confidence_score?.toFixed(2)}</div>\n          </div>\n          <div>\n            <div className=\"font-medium\">Odds</div>\n            <div>{recovery_odds?.toFixed(2)}</div>\n          </div>\n          <div>\n            <div className=\"font-medium\">SAFU</div>\n            <div>{safu_score?.toFixed(2)}</div>\n          </div>\n          <div>\n            <div className=\"font-medium\">Step</div>\n            <div>{step}</div>\n          </div>\n          <div>\n            <div className=\"font-medium\">PnL</div>\n            <div className={open_pnl < 0 ? \"text-red-400\" : \"text-green-400\"}>\n              {(open_pnl ?? 0).toFixed(2)} USDT\n            </div>\n          </div>\n        </div>\n      </div>\n    </Card>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}